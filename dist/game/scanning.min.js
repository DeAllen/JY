var MoleGame=function(){},game=function(){};game.prototype=new Game,g=new game,JY.extend(game.prototype,{newGame:function(){this.now=+new Date,this.blockList=[],this.life=3,this.level=1,this.timer=0,this.x=10,this.y=15,this.open=-1,this.scoreTool,this.drawToolbar(),this.drawMap(),this.scaning(),JY.addClass(b.stage,"start"),this.bindEvent()},bindEvent:function(){var t=this;JY.off(b.stage,"touchstart","i.block"),JY.on(b.stage,"touchstart","i.block",function(e){var i=this.data,o=this.position.x,s=this.position.y;"boom"==i.type?(JY.addClass(i.DOM,"boom"),setTimeout(function(){t.life--},200)):(delete t.blockList[o][s],0==i.type?(i.remove(),t.fuckOther(o,s)):(JY.text(i.DOM,i.type),JY.addClass(i.DOM,"open"))),t.checkLevel()})},fuckOther:function(t,e){var i=this,o=this.blockList[t],s=(o[e],this.blockList.length),h=o.length;if(0!==e){var a=o[e-1];a&&0==a.type&&(a.remove(),delete i.blockList[t][e-1],i.fuckOther(t,e-1))}if(e!==h-1){var r=o[e+1];r&&0==r.type&&(r.remove(),delete i.blockList[t][e+1],i.fuckOther(t,e+1))}if(0!==t){var c=this.blockList[t-1][e];c&&0==c.type&&(c.remove(),delete i.blockList[t-1][e],i.fuckOther(t-1,e))}if(t!==s-1){var n=this.blockList[t+1][e];n&&0==n.type&&(n.remove(),delete i.blockList[t+1][e],i.fuckOther(t+1,e))}},scaning:function(){for(var t=0,e=this.blockList.length;e>t;t++)for(var i=this.blockList[t],o=0,s=i.length;s>o;o++){var h=i[o];if("boom"!=h.type){var a=0;if(0!==o){var r=i[o-1];if("boom"==r.type&&a++,0!==t){var c=this.blockList[t-1][o-1];"boom"==c.type&&a++}if(t!==e-1){var n=this.blockList[t+1][o-1];"boom"==n.type&&a++}}if(o!==s-1){var l=i[o+1];if("boom"==l.type&&a++,0!==t){var b=this.blockList[t-1][o+1];"boom"==b.type&&a++}if(t!==e-1){var p=this.blockList[t+1][o+1];"boom"==p.type&&a++}}if(0!==t){var v=this.blockList[t-1][o];"boom"==v.type&&a++}if(t!==e-1){var f=this.blockList[t+1][o];"boom"==f.type&&a++}h.type=a}}},coutTimer:function(){var t=+new Date,e=t-this.now;this.timer=e/1e3,JY.text(this.scoreTool.DOM,"时间："+this.timer+" s")},drawToolbar:function(){this.scoreTool=new Sprite(140,30),this.scoreTool.setPosition(b.stage.width/2-70,b.stage.height-30),JY.text(this.scoreTool.DOM,"时间:0"),b.addChild(this.scoreTool)},drawMap:function(){this.blockList=[];for(var t=Math.floor(b.stage.width/this.x),e=t,i=0;i<this.y;i++){for(var o=[],s=0;s<this.x;s++){var h=new Sprite(t,e);JY.addClass(h.DOM,"block"),h.setPosition(s*t,i*e);var a=1e3*Math.random();h.type=0,h.DOM.data=h,h.DOM.position={x:i,y:s},a<150*this.level&&(h.type="boom"),b.addChild(h),o.push(h)}this.blockList.push(o)}},runGame:function(){this.coutTimer(),this.checkLife()},checkLevel:function(){var t=!0;if(JY.each(this.blockList,function(e,i){JY.each(e,function(e,i){e&&"boom"!==e.type&&(t=!1)})}),t){this.level++,b.clearState();var e=this;e.levelup()}},levelup:function(){this.drawToolbar(),this.drawMap(),this.scaning(),b.startTimer()},checkLife:function(){if(this.life<=0){b.checkState(JYGSTATE.STATE_SYSTEM_GAME_OVER);var t=b.stage.height/3,e=50;b.gameOverScreen=JY.convertDOM('<div style="color:#555;width:300px;margin:0 auto;position:absolute;top:'+t+"px;left:"+e+'px;"><h1>游戏结束!</h1><p>在本次游戏中您共通关'+(this.level-1)+"关,总耗时"+this.timer+"秒,截图炫耀吧!</p><p>点击重新开始游戏</p></div>")}JY.html(b.scoreScreen,"生命值:"+this.life)}}),MoleGame.prototype=new JYG(JY.byId("gameboard")),JY.extend(MoleGame.prototype,{init:function(){this.game=g,this.frequency=30,this.waitTime=5,this.checkState(JYGSTATE.STATE_SYSTEM_TITLE),this.startTimer(),b.stage.width>768&&(b.stage.width=768,JY.width(b.stage,768));var t=this.stage.height/3,e=50;this.titleScreen=JY.convertDOM('<div style="color:#555;width:300px;margin:0 auto;position:absolute;top:'+t+"px;left:"+e+'px;"><h1>扫雷</h1></div>'),this.InstructionsScreen=JY.convertDOM('<div style="color:#555;width:300px;margin:0 auto;position:absolute;top:'+t+"px;left:"+e+'px;"><h1>扫雷</h1><p>点击开始游戏</p>作者：田想兵55342775@qq.com</div>'),this.scoreScreen=JY.convertDOM('<div style="color:#555;width:100px;position:absolute;bottom:10px;right:0;" id="scoreScreen"></div>');var i=1.5*b.stage.width;JY.height(b.stage,i)}});var b=new MoleGame;b.init();
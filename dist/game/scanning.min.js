!function(t){var e=function(){},i=function(){};i.prototype=new Game,g=new i,t.extend(i.prototype,{newGame:function(){this.now=+new Date,this.blockList=[],this.life=1,this.level=1,this.timer=0,this.x=10,this.y=15,this.open=-1,this.scoreTool,this.drawToolbar(),this.drawMap(),this.scaning(),t.addClass(o.stage,"start")},bindEvent:function(e,i,o){var s=this;t.touch(e.DOM,function(){"boom"==e.type?(t.addClass(e.DOM,"boom"),setTimeout(function(){s.life--},200)):(delete s.blockList[i][o],0==e.type?(e.remove(),s.fuckOther(i,o)):(t.text(e.DOM,e.type),t.addClass(e.DOM,"open"))),s.checkLevel()})},fuckOther:function(t,e){var i=this,o=this.blockList[t],s=(o[e],this.blockList.length),h=o.length;if(0!==e){var r=o[e-1];r&&0==r.type&&(r.remove(),delete i.blockList[t][e-1],i.fuckOther(t,e-1))}if(e!==h-1){var a=o[e+1];a&&0==a.type&&(a.remove(),delete i.blockList[t][e+1],i.fuckOther(t,e+1))}if(0!==t){var c=this.blockList[t-1][e];c&&0==c.type&&(c.remove(),delete i.blockList[t-1][e],i.fuckOther(t-1,e))}if(t!==s-1){var n=this.blockList[t+1][e];n&&0==n.type&&(n.remove(),delete i.blockList[t+1][e],i.fuckOther(t+1,e))}},scaning:function(){for(var t=0,e=this.blockList.length;e>t;t++)for(var i=this.blockList[t],o=0,s=i.length;s>o;o++){var h=i[o];if("boom"!=h.type){var r=0;if(0!==o){var a=i[o-1];if("boom"==a.type&&r++,0!==t){var c=this.blockList[t-1][o-1];"boom"==c.type&&r++}if(t!==e-1){var n=this.blockList[t+1][o-1];"boom"==n.type&&r++}}if(o!==s-1){var l=i[o+1];if("boom"==l.type&&r++,0!==t){var p=this.blockList[t-1][o+1];"boom"==p.type&&r++}if(t!==e-1){var v=this.blockList[t+1][o+1];"boom"==v.type&&r++}}if(0!==t){var f=this.blockList[t-1][o];"boom"==f.type&&r++}if(t!==e-1){var d=this.blockList[t+1][o];"boom"==d.type&&r++}h.type=r}}},coutTimer:function(){var e=+new Date,i=e-this.now;this.timer=i/1e3,t.text(this.scoreTool.DOM,"时间："+this.timer+" s")},drawToolbar:function(){this.scoreTool=new Sprite(140,30),this.scoreTool.setPosition(o.stage.width/2-70,o.stage.height-30),t.text(this.scoreTool.DOM,"时间:0"),o.addChild(this.scoreTool)},drawMap:function(){this.blockList=[];for(var e=Math.floor(o.stage.width/this.x),i=e,s=this,h=0;h<this.y;h++){for(var r=[],a=0;a<this.x;a++){var c=new Sprite(e,i);t.addClass(c.DOM,"block"),c.setPosition(a*e,h*i);var n=1e3*Math.random();c.type=0,n<50*this.level&&(c.type="boom"),function(t,e){s.bindEvent(c,t,e)}(h,a),o.addChild(c),r.push(c)}this.blockList.push(r)}},runGame:function(){this.coutTimer(),this.checkLife()},checkLevel:function(){var e=!0;if(t.each(this.blockList,function(i,o){t.each(i,function(t,i){t&&"boom"!==t.type&&(e=!1)})}),e){this.level++,o.clearState();var i=this;i.levelup()}},levelup:function(){this.drawToolbar(),this.drawMap(),this.scaning(),o.startTimer()},checkLife:function(){if(0==this.life){o.checkState(JYGSTATE.STATE_SYSTEM_GAME_OVER);var e=o.stage.height/3,i=50;o.gameOverScreen=t.convertDOM('<div style="color:#555;width:300px;margin:0 auto;position:absolute;top:'+e+"px;left:"+i+'px;"><h1>游戏结束!</h1><p>在本次游戏中您共通关'+(this.level-1)+"关,总耗时"+this.timer+"秒,截图炫耀吧!</p><p>点击重新开始游戏</p></div>")}}}),e.prototype=new JYG(t.byId("gameboard")),t.extend(e.prototype,{init:function(){this.game=g,this.frequency=30,this.waitTime=5,this.checkState(JYGSTATE.STATE_SYSTEM_TITLE),this.startTimer(),o.stage.width>768&&(o.stage.width=768,t.width(o.stage,768));var e=this.stage.height/3,i=50;this.titleScreen=t.convertDOM('<div style="color:#555;width:300px;margin:0 auto;position:absolute;top:'+e+"px;left:"+i+'px;"><h1>扫雷</h1></div>'),this.InstructionsScreen=t.convertDOM('<div style="color:#555;width:300px;margin:0 auto;position:absolute;top:'+e+"px;left:"+i+'px;"><h1>扫雷</h1><p>点击开始游戏</p>作者：田想兵55342775@qq.com</div>'),this.scoreScreen=t.convertDOM('<div style="color:#555;width:100px;float:right;" id="scoreScreen"></div>');var s=1.5*o.stage.width;t.height(o.stage,s)}});var o=new e;o.init()}(JY);
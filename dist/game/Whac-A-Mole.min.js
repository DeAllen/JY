!function(t){var i=function(){},e=function(){};e.prototype=new Game,g=new e,t.extend(e.prototype,{newGame:function(){this.level=1,this.life=5,this.v=15,this.hitsArr=[],this.scoreType=[1,2,5,-5],this.killArr=[0,0,0,0],this.T=null,this.score=0,this.wait=20,this.drawToolbar(),this.drawMap(),this.bindEvent()},runGame:function(){this.creaetMole(),this.checkLife(),this.animateMole(),this.createT(),this.kill(),this.checkScore(),this.getScore(),this.checkLevel()},checkLevel:function(){this.level=Math.floor(this.score/10),this.wait=Math.max(this.wait-this.level,0)},bindEvent:function(){var i=this;t.unbind(h.stage,"touchend"),t.bind(h.stage,"touchend",function(e){var h=e.changedTouches[0],a={x:h.pageX-i.T.width/4,y:h.pageY-i.T.height/2};return i.T.setPosition(a.x,a.y),i.T.data=3,t.addClass(i.T.DOM,"zoomIn animated"),!1}),t.unbind(h.stage,"touchmove"),t.bind(h.stage,"touchmove",function(t){var e=t.changedTouches[0],h={x:e.pageX-i.T.width/4,y:e.pageY-i.T.height/2};return i.T.setPosition(h.x,h.y),!1})},getScore:function(){var i=this;t.resolve(function(e,h){var a=i.scoreTool,o=e,s=i.v,r=a.x+a.width/2-o.x,n=a.y+a.height/2-o.y,l=Math.atan2(r,n);o.x+=Math.floor(Math.sin(l)*s),o.y+=Math.floor(Math.cos(l)*s);var d=o.data;d.width=.95*d.width,d.height=.95*d.height,t.width(o.DOM,d.width),t.height(o.DOM,d.height),t.width(d.DOM,d.width),t.height(d.DOM,d.height);var c=.98*(t.css(d.DOM,"opacity")||1);d.setStyle({opacity:c}),o.setPosition(),t.hits(o,a)&&(d.remove(),delete d,o.remove(),delete o,delete i.hitsArr[h])},0,this.hitsArr.length,this.hitsArr)},kill:function(){if(this.T.data){this.T.data--,0==this.T.data&&t.removeClass(this.T.DOM,"zoomIn").removeClass(this.T.DOM,"animated");var i=this;t.resolve(function(e,h){var a=e.data;if(a){var o=a.data;o&&t.hits(a,{x:i.T.x,y:i.T.y,width:i.T.width/2,height:i.T.height})&&(i.hitsArr.push(a),i.score+=o.score,i.killArr[o.type]++,e.data=null,delete i.pullArr[h])}},0,this.pullArr.length,this.pullArr)}},checkScore:function(){t.text(this.scoreTool.DOM,"得分:"+this.score)},createT:function(){this.T||(this.T=new Sprite(this.holeW,this.holeW/2),t.addClass(this.T.DOM,"T"),this.T.setPosition(h.stage.width/3,h.stage.height/3),h.addChild(this.T))},drawMap:function(){var i=h.stage.width/3,e=h.stage.height/4;this.holeW=i,this.holeH=e,this.pullArr=[];for(var a=0,o=12;o>a;a++){var s={};s.x=a%3*i;var r=Math.floor(a/3);s.y=r*e+20;var n=new Sprite(.8*i,.8*i);n.setPosition(s.x,s.y),t.addClass(n.DOM,"hole"),h.addChild(n),this.pullArr.push(n)}},drawToolbar:function(){var i=new Sprite(h.stage.width,20);this.scoreTool=new Sprite(100,20),t.text(this.scoreTool.DOM,"得分:0"),this.lifeTool=new Sprite(h.stage.width-110,20),this.lifeTool.setPosition(110,0),i.addChild(this.lifeTool),i.addChild(this.scoreTool),h.addChild(i)},creaetMole:function(){var i=Math.floor(100*Math.random());if(i<this.level+10){var e=this.holeW/2*1.333,a=this.pullArr.length,o=Math.floor(Math.random()*a),s=this.pullArr[o];if(s&&!s.data){{var r=new Sprite(this.holeW/2,0),n=new Sprite(this.holeW/2,e);Math.random()*(t.width(h.stage)-n.width)}r.time=0,r.wait=this.wait,r["for"]=0,s.data=r,r.setPosition(s.x+(this.holeW-s.width)/2,s.y+s.height/2);var l=Math.ceil(4*Math.random());n.score=this.scoreType[Math.ceil(4*Math.random())-1],n.type=l-1,t.addClass(n.DOM,"c-"+l),r.data=n,r.addChild(n),h.addChild(r)}}},animateMole:function(){var i=this;t.resolve(function(e,h){if(e.data){var a=e.data,o=a.data,s=(a.time,o.height/15);if(a.time<10&&0==a["for"]){var r=s*a.time;t.height(a.DOM,r),a.height=r,a.setPosition(a.x,a.y-.7*s),a.time++}if(10==a.time&&a.wait&&(a.wait--,t.addClass(a.DOM,"hehe")),!a.wait&&(10==a.time||1==a["for"])){a["for"]=1;var r=s*a.time;t.height(a.DOM,r),a.height=r,a.setPosition(a.x,a.y+.7*s),a.time--}a.time<=0&&(o.score>0&&(i.life-=1),o.remove(),a.remove(),a=null,o=null,e.data=null)}},0,this.pullArr.length,this.pullArr)},checkLife:function(){this.life<=0&&(h.gameOverScreen=t.convertDOM('<div style="padding:50% 0px;width:300px;margin:0 auto; position:relative;" class="gameover"><div style="position:absolute;background:url(images/Whac-A-Mole/cat.png) no-repeat center center ;background-size:200px;opacity:0.2;position:absolute;top:20%;left:0;width:100%;height:300px;"></div><h1>游戏结束鸟!</h1><p>您在本次游戏中共打了'+this.score+'分</p><p><i class="c-1"></i> x '+this.killArr[0]+'<i class="c-2"></i> x '+this.killArr[1]+'<i class="c-3"></i> x '+this.killArr[2]+'<i class="c-4"></i> x '+this.killArr[3]+"</p><p>猛击之后重新来过！</p></div>"),h.checkState(JYGSTATE.STATE_SYSTEM_GAME_OVER))}}),i.prototype=new JYG(t.byId("gameboard")),t.extend(i.prototype,{init:function(){this.game=g,this.frequency=50,this.waitTime=5,this.checkState(JYGSTATE.STATE_SYSTEM_TITLE),this.startTimer(),this.titleScreen=t.convertDOM('<div style="color:#555;padding:50% 0px;width:300px;margin:0 auto;position:relative;"><h1>打卡乐猫</h1><div style="position:absolute;background:url(images/Whac-A-Mole/cat.png) no-repeat center center ;background-size:200px;opacity:0.2;position:absolute;top:20%;left:0;width:100%;height:300px;"></div></div>'),this.InstructionsScreen=t.convertDOM('<div style="padding:50% 0px;width:300px;margin:0 auto; position:relative;"><div style="position:absolute;background:url(images/Whac-A-Mole/cat.png) no-repeat center center ;background-size:200px;opacity:0.2;position:absolute;top:20%;left:0;width:100%;height:300px;"></div><h1>打卡乐猫</h1><p>点击开始游戏</p><a>作者：田想兵</a>55342775@qq.com</div>'),this.scoreScreen=t.convertDOM('<div style="color:#555;width:100px;float:right;" id="scoreScreen"></div>')}});var h=new i;h.init()}(JY);
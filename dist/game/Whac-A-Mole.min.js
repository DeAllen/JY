!function(t){var i=function(){},e=function(){};e.prototype=new Game,g=new e,t.extend(e.prototype,{newGame:function(){this.level=0,this.life=3,this.v=15,this.hitsArr=[],this.scoreType=[1,2,5,-5],this.killArr=[0,0,0,0,0,0,0,0],this.T=null,this.score=0,this.wait=30,this.count=40,this.sc=0,this.drawToolbar(),this.drawMap()},runGame:function(){this.creaetMole(),this.checkLife(),this.animateMole(),this.createT(),this.kill(),this.checkScore(),this.getScore(),this.checkLevel()},checkLevel:function(){this.level=Math.floor(this.score/10),this.wait=Math.max(30-this.level,0)},bindEvent:function(){var i=this;t.bind(s.stage,"touchend",function(e){if(7==s.currentState){var o=e.changedTouches[0],h={x:o.pageX-i.T.width/4,y:o.pageY-i.T.height/2};return i.T.setPosition(h.x,h.y),i.T.data=3,t.addClass(i.T.DOM,"zoomIn animated"),!1}}),t.bind(s.stage,"touchmove",function(t){if(7==s.currentState){var e=t.changedTouches[0],o={x:e.pageX-i.T.width/4,y:e.pageY-i.T.height/2};return i.T.setPosition(o.x,o.y),!1}})},getScore:function(){var i=this;t.resolve(function(e,s){var o=i.scoreTool,h=e,a=i.v,r=o.x+o.width/2-h.x,l=o.y+o.height/2-h.y,n=Math.atan2(r,l);h.x+=Math.floor(Math.sin(n)*a),h.y+=Math.floor(Math.cos(n)*a);var c=h.data;c.width=.95*c.width,c.height=.95*c.height,t.width(h.DOM,c.width),t.height(h.DOM,c.height),t.width(c.DOM,c.width),t.height(c.DOM,c.height);var d=.98*(t.css(c.DOM,"opacity")||1);c.setStyle({opacity:d}),h.setPosition(),t.hits(h,o)&&(c.remove(),delete c,h.remove(),delete h,delete i.hitsArr[s])},0,this.hitsArr.length,this.hitsArr)},kill:function(){if(this.T.data){this.T.data--,0==this.T.data&&t.removeClass(this.T.DOM,"zoomIn").removeClass(this.T.DOM,"animated");var i=this;t.resolve(function(e,o){var h=e.data;if(h){var a=h.data;if(a&&t.hits(h,{x:i.T.x,y:i.T.y,width:i.T.width/2,height:i.T.height})){i.hitsArr.push(h),i.score+=a.score,i.killArr[a.type]++,e.data=null;var r=new Sprite(50,50);t.text(r.DOM,a.score>0?"+"+a.score:a.score),t.css(r.DOM,{color:"#fff",fontSize:"48px",fontWeight:"bold"}),r.setPosition(i.T.x+10,i.T.y-10),s.addChild(r),function(t){setTimeout(function(){t.remove()},500)}(r)}}},0,this.pullArr.length,this.pullArr)}},checkScore:function(){t.text(this.scoreTool.DOM,"得分:"+this.score),this.score>100&&t.addClass(s.stage,"highbg")},createT:function(){this.T||(this.T=new Sprite(this.holeW,this.holeW/2),t.addClass(this.T.DOM,"T"),this.T.setPosition(s.stage.width/3,s.stage.height/3),s.addChild(this.T))},drawMap:function(){var i=s.stage.width/3,e=s.stage.height/4;this.holeW=i,this.holeH=e,this.pullArr=[];for(var o=0,h=12;h>o;o++){var a={};a.x=o%3*i;var r=Math.floor(o/3);a.y=r*e+20;var l=new Sprite(.8*i,.8*i);l.setPosition(a.x,a.y),t.addClass(l.DOM,"hole"),s.addChild(l),this.pullArr.push(l)}},drawToolbar:function(){var i=new Sprite(s.stage.width,20);this.scoreTool=new Sprite(100,20),t.text(this.scoreTool.DOM,"得分:0"),this.lifeTool=new Sprite(s.stage.width-110,20),this.lifeTool.setPosition(110,0),i.addChild(this.lifeTool),i.addChild(this.scoreTool),s.addChild(i)},creaetMole:function(){if(this.sc+Math.floor(10*Math.random())>=this.count-2*this.level){this.sc=0;var i=this.holeW/2*1.333,e=this.pullArr.length,o=Math.floor(Math.random()*e),h=this.pullArr[o];if(h&&!h.data){{var a=new Sprite(this.holeW/2,0),r=new Sprite(this.holeW/2,i);Math.random()*(t.width(s.stage)-r.width)}a.time=0,a.wait=this.wait,a["for"]=0,h.data=a,a.setPosition(h.x+(this.holeW-h.width)/2,h.y+h.height/2);var l=Math.ceil(4*Math.random());this.score>100?(r.score=10,r.type=l-1,t.addClass(r.DOM,"d-"+l)):(r.score=this.scoreType[l-1],r.type=l+4-1,t.addClass(r.DOM,"c-"+l)),a.data=r,a.addChild(r),s.addChild(a)}}this.sc++},animateMole:function(){var i=this;t.resolve(function(e,s){if(e.data){var o=e.data,h=o.data,a=(o.time,h.height/15);if(o.time<10&&0==o["for"]){var r=a*o.time;t.height(o.DOM,r),o.height=r,o.setPosition(o.x,o.y-.7*a),o.time++}if(10==o.time&&o.wait&&(o.wait--,t.addClass(o.DOM,"hehe")),!o.wait&&(10==o.time||1==o["for"])){o["for"]=1;var r=a*o.time;t.height(o.DOM,r),o.height=r,o.setPosition(o.x,o.y+.7*a),o.time--}o.time<=0&&(h.score>0&&(i.life-=1),h.remove(),o.remove(),o=null,h=null,e.data=null)}},0,this.pullArr.length,this.pullArr)},checkLife:function(){if(this.life<=0){t.removeClass(s.stage,"highbg");var i=parseInt(t.cookie("klm"))||0;i=Math.max(i,this.score),t.cookie("klm",i,30);var e="",o="";this.score>100&&this.score<1e3?(e="您获得 百人斩 称号,",o='<p><i class="d-1"></i> x '+this.killArr[4]+' <i class="d-2"></i> x '+this.killArr[5]+' <i class="d-3"></i> x '+this.killArr[6]+' <i class="d-4"></i> x '+this.killArr[7]+"</p>"):this.score>1e3&&(e="您获得 千人斩 称号,",o='<p><i class="d-1"></i> x '+this.killArr[4]+' <i class="d-2"></i> x '+this.killArr[5]+' <i class="d-3"></i> x '+this.killArr[6]+' <i class="d-4"></i> x '+this.killArr[7]+"</p>"),s.gameOverScreen=t.convertDOM('<div style="padding:50% 0px;width:300px;margin:0 auto; position:relative;" class="gameover"><div style="position:absolute;background:url(images/Whac-A-Mole/cat.png) no-repeat center center ;background-size:200px;opacity:0.2;position:absolute;top:20%;left:0;width:100%;height:300px;"></div><div style="position:absolute;top:50%;left:0;z-index:2;"><h1>游戏结束!</h1>'+e+"<p>您在本次游戏中共打了"+this.score+'分</p><p><i class="c-1"></i> x '+this.killArr[0]+' <i class="c-2"></i> x '+this.killArr[1]+' <i class="c-3"></i> x '+this.killArr[2]+' <i class="c-4"></i> x '+this.killArr[3]+"</p><p>历史最高得分："+i+"</p>"+o+"<p>猛击之后重新来过！</p></div></div>");var h=t.convertDOM('<p style="position:absolute;bottom:0;right:0;color:#fff;z-index:99;">点击进入卡乐猫商城</p>');t.touch(h,function(){return location.href="http://v.ewanse.com/",!1}),t.append(s.gameOverScreen,h),s.checkState(JYGSTATE.STATE_SYSTEM_GAME_OVER)}}}),i.prototype=new JYG(t.byId("gameboard")),t.extend(i.prototype,{init:function(){this.game=g,this.frequency=30,this.waitTime=5,this.checkState(JYGSTATE.STATE_SYSTEM_TITLE),this.startTimer(),this.titleScreen=t.convertDOM('<div style="color:#555;padding:50% 0px;width:300px;margin:0 auto;position:relative;"><h1>打卡乐猫</h1><div style="position:absolute;background:url(images/Whac-A-Mole/cat.png) no-repeat center center ;background-size:200px;opacity:0.2;position:absolute;top:20%;left:0;width:100%;height:300px;"></div></div>'),this.InstructionsScreen=t.convertDOM('<div style="padding:50% 0px;width:300px;margin:0 auto; position:relative;"><div style="position:absolute;background:url(images/Whac-A-Mole/cat.png) no-repeat center center ;background-size:200px;opacity:0.2;position:absolute;top:20%;left:0;width:100%;height:300px;"></div><h1>打卡乐猫</h1><p>点击开始游戏</p>作者：田想兵55342775@qq.com</div>'),this.scoreScreen=t.convertDOM('<div style="color:#555;width:100px;float:right;" id="scoreScreen"></div>');var i=t.convertDOM('<p style="position:absolute;bottom:0;right:0;color:#fff;z-index:99;">点击进入卡乐猫商城</p>');t.touch(i,function(){return location.href="http://v.ewanse.com/",!1}),t.append(this.InstructionsScreen,i)}});var s=new i;s.init(),g.bindEvent()}(JY);